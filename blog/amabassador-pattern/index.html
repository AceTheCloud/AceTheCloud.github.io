<!doctype html><html><head><meta charset=utf-8><title>Amabassador Pattern</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><link rel=stylesheet href=https://acethecloud.com/themify/themify.css><link href=https://acethecloud.com/scss/critical.min.css rel=stylesheet><link rel=stylesheet href=https://acethecloud.com/css/custom.css><link rel="shortcut icon" href=https://acethecloud.com/images/favicon.png type=image/x-icon><link rel=icon href=https://acethecloud.com/images/favicon.png type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-54XSTRSXS5"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-54XSTRSXS5")</script></head><body><nav class="main-nav navbar navbar-expand-lg"><div class=container-fluid><a class=navbar-brand href=https://acethecloud.com><img class=logo-main src=https://acethecloud.com/images/logo.png alt=logo-white></a>
<button class="navbar-toggler collapsed" type=button data-toggle=collapse data-target=#mainNav>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button><div class="collapse navbar-collapse nav-list" id=mainNav><ul class="navbar-nav ml-auto"><li class=nav-item><a href=https://acethecloud.com#hero class=nav-link>Home</a></li><li class=nav-item><a href=https://acethecloud.com#faq class=nav-link>Clouds</a></li><li class=nav-item><a href=https://acethecloud.com/contact class=nav-link>Contact</a></li></ul><div class="account-list list-inline"><li class=list-inline-item><a href=https://acethecloud.com/blog class="btn btn-sm btn-violate">Blog</a></li></div></div></div></nav><div id=content><meta property="og:image" content="https://acethecloud.com/images/blog/ambassador-pattern.png"><meta property="og:image:type" content="image/png"><section class="page-header blog-single-header"><div class=container><div class=row><div class=col-lg-12><h2>Amabassador Pattern</h2><div class=post-meta><img src=https://acethecloud.com/images/blog/ambassador-pattern.png style=margin-left:-30px;width:390px alt=feature-image></div><div class=post-meta><ul><li><img src=https://acethecloud.com/images/client/abhishek.png alt=author-thumb><h5>Abhishek</h5></li><li></li><li><b>Date Posted</b><br>December 9, 2022</li><li></li><li><b>Read Time</b> :<br>3 minutes</li></ul><br><div style=scroll-behavior:auto><ul><li class=tag><b>Topics â‡¢</b></li><li class=tag><a href=https://acethecloud.com/tags/design/>design</a></li><li class=tag><a href=https://acethecloud.com/tags/patterns/>patterns</a></li><li class=tag><a href=https://acethecloud.com/tags/best-practices/>best-practices</a></li><li class=tag><a href=https://acethecloud.com/tags/kubernetes/>kubernetes</a></li><li class=tag><a href=https://acethecloud.com/tags/docker/>docker</a></li></ul></div></div></div></div></div></section><section class=blog-single><div class=container style=width:100%><div style=width:100%><article class=blog-single-post style=padding:30px><p>Resilient cloud-based applications require features such as circuit breaking, routing, metering and monitoring, and the ability to make network-related configuration updates. It may be difficult or impossible to update legacy applications or existing code libraries to add these features, because the code is no longer maintained or can&rsquo;t be easily modified by the development team.</p><p>Network calls also require substantial configuration for connection, authentication, and authorization. If these calls are used across multiple applications, built using multiple languages and frameworks, the calls must be configured for each of these instances. In addition, network and security functionality may need to be managed by a central team within your organization. With a large code base, it can be risky for that team to update application code they aren&rsquo;t familiar with.</p><h3 id=solution>Solution</h3><p>Put client frameworks and libraries into an external process that acts as a proxy between your application and external services. Deploy the proxy on the same host environment as your application to allow control over routing, resiliency, security features, and to avoid any host-related access restrictions. You can also use the ambassador pattern to standardize and extend instrumentation. The proxy can monitor performance metrics such as latency or resource usage, and this monitoring happens in the same host environment as the application.</p><h3 id=when-to-use-this-pattern>When to use this pattern</h3><p>Use this pattern when you:</p><ul><li>Need to build a common set of client connectivity features for multiple languages or frameworks.</li><li>Need to offload cross-cutting client connectivity concerns to infrastructure developers or other more specialized teams.</li><li>Need to support cloud or cluster connectivity requirements in a legacy application or an application that is difficult to modify.</li></ul><h3 id=this-pattern-may-not-be-suitable>This pattern may not be suitable:</h3><ul><li>When network request latency is critical. A proxy will introduce some overhead, although minimal, and in some cases this may affect the application.</li><li>When client connectivity features are consumed by a single language. In that case, a better option might be a client library that is distributed to the development teams as a package.</li><li>When connectivity features cannot be generalized and require deeper integration with the client application.</li></ul><h3 id=here-is-an-example-of-how-you-might-implement-the-ambassador-pattern-in-go-using-the-kubernetes-api>Here is an example of how you might implement the Ambassador pattern in Go using the Kubernetes API:</h3><p>This code sets up a connection to the Kubernetes API server and creates a Kubernetes client.</p><p>It then creates an HTTP handler function that routes requests to the appropriate microservice based on the request parameters and makes a request to the target microservice using the Kubernetes client.</p><p>The response from the target microservice is then written back to the client.</p><div class=highlight><div style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>package</span> main
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#4070a0>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#4070a0>&#34;net/http&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#4070a0>&#34;k8s.io/client-go/kubernetes&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#4070a0>&#34;k8s.io/client-go/rest&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>func</span> <span style=color:#06287e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// Set up a connection to the Kubernetes API server
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	config, err <span style=color:#666>:=</span> rest.<span style=color:#06287e>InClusterConfig</span>()
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span> err <span style=color:#666>!=</span> <span style=color:#007020;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#007020>panic</span>(err.<span style=color:#06287e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// Create a Kubernetes client
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	client, err <span style=color:#666>:=</span> kubernetes.<span style=color:#06287e>NewForConfig</span>(config)
</span></span><span style=display:flex><span>	<span style=color:#007020;font-weight:700>if</span> err <span style=color:#666>!=</span> <span style=color:#007020;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#007020>panic</span>(err.<span style=color:#06287e>Error</span>())
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	http.<span style=color:#06287e>HandleFunc</span>(<span style=color:#4070a0>&#34;/&#34;</span>, <span style=color:#007020;font-weight:700>func</span>(w http.ResponseWriter, r <span style=color:#666>*</span>http.Request) {
</span></span><span style=display:flex><span>		<span style=color:#60a0b0;font-style:italic>// Route the request to the appropriate microservice
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		<span style=color:#60a0b0;font-style:italic>// based on the URL path or other request parameters
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		targetService <span style=color:#666>:=</span> <span style=color:#06287e>routeRequest</span>(r)
</span></span><span style=display:flex><span>		<span style=color:#60a0b0;font-style:italic>// Make a request to the target microservice
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		response, err <span style=color:#666>:=</span> client.<span style=color:#06287e>CoreV1</span>().<span style=color:#06287e>Services</span>(namespace).<span style=color:#06287e>ProxyGet</span>(targetService, targetPath, params).<span style=color:#06287e>Do</span>()
</span></span><span style=display:flex><span>		<span style=color:#007020;font-weight:700>if</span> err <span style=color:#666>!=</span> <span style=color:#007020;font-weight:700>nil</span> {
</span></span><span style=display:flex><span>			http.<span style=color:#06287e>Error</span>(w, err.<span style=color:#06287e>Error</span>(), http.StatusInternalServerError)
</span></span><span style=display:flex><span>			<span style=color:#007020;font-weight:700>return</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#60a0b0;font-style:italic>// Write the response from the target microservice back to the client
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>		w.<span style=color:#06287e>Write</span>(response)
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	http.<span style=color:#06287e>ListenAndServe</span>(<span style=color:#4070a0>&#34;:8080&#34;</span>, <span style=color:#007020;font-weight:700>nil</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#007020;font-weight:700>func</span> <span style=color:#06287e>routeRequest</span>(r <span style=color:#666>*</span>http.Request) <span style=color:#902000>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#60a0b0;font-style:italic>// Determine the target microservice based on the request parameters
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#60a0b0;font-style:italic>// For example, you might use the URL path or query string to determine the target service
</span></span></span><span style=display:flex><span><span style=color:#60a0b0;font-style:italic></span>	<span style=color:#007020;font-weight:700>return</span> targetService
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>Keep in mind that this is just a simplified example and may not include all of the features and functionality that you might want in a real-world ambassador service.</p><h3 id=there-are-a-few-reasons-why-you-might-not-want-to-use-the-ambassador-pattern-in-your-kubernetes-application>There are a few reasons why you might not want to use the Ambassador pattern in your Kubernetes application:</h3><p><strong>Complexity:</strong></p><p>The Ambassador pattern adds an additional layer of complexity to your application by introducing an extra service that acts as a proxy between the client and the target microservices. This can make it more difficult to understand and maintain the application.</p><p><strong>Performance:</strong></p><p>The Ambassador pattern can potentially add overhead to your application by requiring an extra network hop for each request. This can impact the performance of your application, particularly for high-traffic applications or applications that require low latency.</p><p><strong>Limited functionality:</strong></p><p>The Ambassador pattern may not provide all of the features and functionality that you need for your application. For example, if you need to add advanced routing or load balancing capabilities, you may need to use a more feature-rich ingress controller.</p><p>In general, the Ambassador pattern is most suitable for relatively simple applications that do not require advanced routing or load balancing capabilities. If your application has more complex requirements, you may want to consider using a different approach, such as an ingress controller or a service mesh.</p></article></div></div><div class=container style=padding:50px><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//acethecloud.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></section></div><footer class=footer><div class=container><div class=row><div class=col-lg-12><div class=footer-subscribe-title><h2>Get the latest blog updates</h2></div></div><div class="col-lg-8 mx-auto"><form action=# class=footer-subscribe-form><div class=from-group><div class=input-group><input type=email class=form-control placeholder="Enter Your E-mail"><div class=subscribe><button class="btn btn-subscribe" type=submit>
<span class=btn-area>Subscribe</span><svg class="icon-left" xmlns="http://www.w3.org/2000/svg" width="16.317" height="15.323" viewBox="0 0 16.317 15.323"><g data-name="Group 1167"><g data-name="Group 1166"><path data-name="Path 1349" d="M.004 5.359a.7.7.0 00.587.693l6.091 1.609L.591 9.27a.7.7.0 00-.587.693v4.656a.7.7.0 00.206.5.726.726.0 00.119.1.7.7.0 00.675.044l14.911-6.958a.7.7.0 000-1.274L1.004.066a.7.7.0 00-1 .637zm13.952 2.3" fill="#fff"/></g></g></svg><svg class="icon-center" xmlns="http://www.w3.org/2000/svg" width="16.317" height="15.323" viewBox="0 0 16.317 15.323"><g data-name="Group 1167"><g data-name="Group 1166"><path data-name="Path 1349" d="M.004 5.359a.7.7.0 00.587.693l6.091 1.609L.591 9.27a.7.7.0 00-.587.693v4.656a.7.7.0 00.206.5.726.726.0 00.119.1.7.7.0 00.675.044l14.911-6.958a.7.7.0 000-1.274L1.004.066a.7.7.0 00-1 .637zm13.952 2.3" fill="#fff"/></g></g></svg></button></div></div></div></form></div></div><div class=row><div class="col-lg-4 col-md-4"><div class=footer-description><img src=https://acethecloud.com/images/logo.png alt=logo><p>All right reserved</br>Copyright Â© <a href=https://AceTheCloud.com/ target=_blank>AceTheCloud</a> 2022</p><ul class=footer-description-social><li><a href=https://facebook.com/cloud.and.mobile.evangelist/><i class=ti-facebook></i></a></li><li><a href=https://twitter.com/AbhiForTweeting><i class=ti-twitter-alt></i></a></li><li><a href=https://github.com/AbhiOnGithub><i class=ti-github></i></a></li></ul></div></div><div class="col-lg-4 col-md-4"><div class=footer-widget><h4>Sitemap</h4><div class=footer-widget-list><ul><li><a href=https://acethecloud.com>Home</a></li><li><a href=https://acethecloud.com/blog>Latest Article</a></li><li><a href=https://acethecloud.com/privacy>Privacy & Policy</a></li><li><a href=https://acethecloud.com/contact>Contact</a></li></ul></div></div></div><div class="col-lg-4 col-md-4"><div class=footer-widget><h4>Address</h4><div class=footer-widget-list><ul><li><a href=tel:><i class=ti-mobile></i></a></li><li><a href=mailto:abhishek@acethecloud.com><i class=ti-email></i>abhishek@acethecloud.com</a></li><li><p><i class=ti-pin></i></p></li></ul></div></div></div></div></div></footer><link href=https://acethecloud.com/scss/non-critical.min.css rel=stylesheet><script src=https://acethecloud.com/js/vendor.min.js></script>
<script src=https://acethecloud.com/js/script.min.js></script></body></html>